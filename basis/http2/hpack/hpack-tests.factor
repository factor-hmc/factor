! Copyright (C) 2021 Your name.
! See http://factorcode.org/license.txt for BSD license.
USING: tools.test http2.hpack hpack.private hpack kernel ;
IN: http2.hpack.tests

! tests come from RFC 7541, Appendix C

! RFC7541 Appendex C.1
{ BV{ 234 31 154 10 42 } 1   10 } [ BV{ 234 31 154 10 42 } 0 5 decode-integer ] unit-test
{ BV{ 234 31 154 10 42 } 4 1337 } [ BV{ 234 31 154 10 42 } 1 5 decode-integer ] unit-test
{ BV{ 234 31 154 10 42 } 5   42 } [ BV{ 234 31 154 10 42 } 4 8 decode-integer ] unit-test

! RFC7541 Appendix C.2.1 subset
{ BV{ 0x0a 0x63 0x75 0x73 0x74 0x6f 0x6d 0x2d 0x6b 0x65 0x79 }
11 "custom-key" } [ BV{ 0x0a 0x63 0x75 0x73 0x74 0x6f 0x6d 0x2d
0x6b 0x65 0x79 } 0 decode-string ] unit-test

! RFC7541 Appendix C.2.1

! RFC7541 Appendix C.2.2
{ T{ decode-context f 0 { } } BV{ 0x04 0x0c 0x2f 0x73 0x61 0x6d 0x70 0x6c 0x65
    0x2f 0x70 0x61 0x74 0x68 } 14 { ":path" "/sample/path" } }
[ decode-context new BV{ 0x04 0x0c 0x2f 0x73 0x61 0x6d 0x70 0x6c 0x65
    0x2f 0x70 0x61 0x74 0x68 } 0 decode-field ] unit-test

! RFC7541 Appendix C.2.3
{ T{ decode-context f 0 { } } BV{ 0x10 0x08 0x70 0x61 0x73 0x73 0x77 0x6f 0x72
    0x64 0x06 0x73 0x65 0x63 0x72 0x65 0x74 } 17 { "password" "secret" } }
[ decode-context new BV{ 0x10 0x08 0x70 0x61 0x73 0x73 0x77 0x6f 0x72
    0x64 0x06 0x73 0x65 0x63 0x72 0x65 0x74 } 0 decode-field ] unit-test

! RFC7541 Appendix C.2.4
{ T{ decode-context f 0 { } } BV{ 0x82 } 1 { ":method" "GET" } }
[ decode-context new BV{ 0x82 } 0 decode-field ] unit-test

